<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blfire | Private</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000000;
            --surface: #0a0a0a;
            --surface-light: #161616;
            --border: #222;
            --accent: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.2);
            --text-main: #ededed;
            --text-dim: #888;
            --danger: #ef4444;
            --online: #22c55e;
            --gold: #fbbf24;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text-main); height: 100vh; overflow: hidden; display: flex; }

        /* Animations */
        @keyframes shake { 
            0%, 100% { transform: translateX(0); border-color: var(--border); }
            20%, 60% { transform: translateX(-4px); border-color: var(--danger); }
            40%, 80% { transform: translateX(4px); border-color: var(--danger); }
        }
        @keyframes ping-glow {
            0% { box-shadow: 0 0 0px var(--accent); }
            50% { box-shadow: 0 0 15px var(--accent); }
            100% { box-shadow: 0 0 0px var(--accent); }
        }
        .error-shake { animation: shake 0.4s both; }
        .ping-alert { animation: ping-glow 1.5s infinite; border-color: var(--accent) !important; }

        /* Left: Server Rail */
        .server-rail { width: 72px; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding: 1rem 0; gap: 0.8rem; }
        .server-icon {
            width: 48px; height: 48px; border-radius: 50%; background: var(--surface-light);
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; 
            font-weight: 700; border: 2px solid transparent; position: relative;
        }
        .server-icon:hover, .server-icon.active { border-radius: 14px; border-color: var(--accent); background: var(--surface-light); }
        .unread-dot { width: 12px; height: 12px; background: var(--accent); border-radius: 50%; position: absolute; top: -2px; right: -2px; border: 2px solid var(--bg); display: none; }

        /* Center Main Area */
        .main-stage { flex: 1; display: flex; flex-direction: column; background: var(--surface); }
        .top-bar { height: 60px; border-bottom: 1px solid var(--border); display: flex; align-items: center; padding: 0 1.5rem; background: rgba(0,0,0,0.5); backdrop-filter: blur(10px); }
        .server-name-display { font-weight: 800; margin-right: 2rem; font-size: 1rem; }
        
        .channel-tabs { display: flex; gap: 8px; flex: 1; overflow-x: auto; }
        .tab { padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.85rem; color: var(--text-dim); cursor: pointer; }
        .tab.active { background: var(--surface-light); color: var(--accent); font-weight: 600; }
        .tab.pinged { color: var(--accent); font-weight: 800; }

        /* Chat */
        .chat-view { flex: 1; overflow-y: auto; padding: 2rem; display: flex; flex-direction: column; gap: 1.2rem; }
        .msg-row { display: flex; gap: 12px; max-width: 80%; }
        .msg-row.own { align-self: flex-end; flex-direction: row-reverse; }
        .msg-pfp { width: 38px; height: 38px; border-radius: 10px; background-size: cover; cursor: pointer; flex-shrink: 0; }
        .msg-content { display: flex; flex-direction: column; gap: 4px; }
        .msg-user { font-size: 0.75rem; color: var(--text-dim); cursor: pointer; font-weight: 600; }
        .msg-bubble { padding: 0.7rem 1rem; background: var(--surface-light); border-radius: 0 12px 12px 12px; font-size: 0.9rem; line-height: 1.4; border: 1px solid var(--border); }
        .msg-row.own .msg-bubble { background: var(--accent); border: none; border-radius: 12px 0 12px 12px; }
        .ping-msg { background: rgba(59, 130, 246, 0.15) !important; border: 1px solid var(--accent) !important; }

        /* Input */
        .input-dock { padding: 1.5rem 2rem; }
        .input-bar { background: var(--surface-light); border: 1px solid var(--border); border-radius: 12px; padding: 0.8rem 1.2rem; display: flex; align-items: center; }
        .input-bar input { flex: 1; background: transparent; border: none; color: white; outline: none; }

        /* Right: Member List */
        .member-list { width: 220px; border-left: 1px solid var(--border); padding: 1.5rem 1rem; }
        .member-item { display: flex; align-items: center; gap: 10px; margin-bottom: 0.8rem; cursor: pointer; font-size: 0.9rem; padding: 4px; border-radius: 6px; }
        .member-item:hover { background: var(--surface-light); }

        /* Modals */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(6px); display: none; align-items: center; justify-content: center; z-index: 100; }
        .modal { background: var(--surface); border: 1px solid var(--border); width: 380px; padding: 2rem; border-radius: 16px; }
        .field { margin-bottom: 1rem; }
        .field label { display: block; font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; margin-bottom: 5px; }
        .field input { width: 100%; background: var(--bg); border: 1px solid var(--border); color: white; padding: 0.7rem; border-radius: 8px; outline: none; }
        .btn { width: 100%; padding: 0.8rem; border-radius: 8px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; margin-top: 5px; }
        .btn-blue { background: var(--accent); color: white; }
        .btn-ghost { background: transparent; color: var(--text-dim); }

        /* Profile Preview */
        .profile-preview { background: var(--bg); padding: 1.5rem; border-radius: 12px; text-align: center; border: 1px solid var(--border); margin-bottom: 1.5rem; }
        .preview-pfp { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 10px; border: 2px solid var(--accent); }
    </style>
</head>
<body>

    <nav class="server-rail" id="server-rail"></nav>

    <section class="main-stage">
        <header class="top-bar">
            <div class="server-name-display" id="display-srv-name">Blfire</div>
            <div class="channel-tabs" id="channel-tabs"></div>
            <div style="display:flex; gap: 15px;">
                <span style="cursor:pointer;" id="srv-settings-icon" onclick="openSrvSettings()">üõ†Ô∏è</span>
                <span style="cursor:pointer;" onclick="openProfile()">‚öôÔ∏è</span>
            </div>
        </header>

        <div class="chat-view" id="chat-view"></div>

        <div class="input-dock">
            <div class="input-bar" id="input-wrap">
                <input type="text" id="msg-input" placeholder="Send a message..." maxlength="200" autocomplete="off">
            </div>
        </div>
    </section>

    <aside class="member-list">
        <h4 style="font-size: 0.7rem; color: var(--text-dim); margin-bottom: 1rem; letter-spacing: 1px;">MEMBERS</h4>
        <div id="member-items"></div>
    </aside>

    <div class="overlay" id="profile-modal">
        <div class="modal">
            <h3 style="margin-bottom: 1rem;">Settings</h3>
            <div class="profile-preview">
                <img id="prev-pfp" class="preview-pfp" src="">
                <h2 id="prev-name"></h2>
                <p id="prev-id" style="font-family: monospace; font-size: 0.8rem; color: var(--text-dim);"></p>
            </div>
            <div class="field"><label>Username</label><input type="text" id="set-name" maxlength="15"></div>
            <div class="field"><label>Avatar URL</label><input type="text" id="set-pfp"></div>
            <button class="btn btn-blue" onclick="saveProfile()">Save Changes</button>
            <button class="btn btn-ghost" onclick="closeModals()">Close</button>
        </div>
    </div>

    <div class="overlay" id="srv-settings-modal">
        <div class="modal">
            <h3>Server Settings</h3>
            <div class="field" style="margin-top: 1rem;"><label>Server Name</label><input type="text" id="edit-srv-name" maxlength="25"></div>
            <div class="field"><label>Server Icon URL</label><input type="text" id="edit-srv-icon"></div>
            <button class="btn btn-blue" onclick="saveSrvSettings()">Update Server</button>
            <button class="btn btn-ghost" onclick="closeModals()">Cancel</button>
        </div>
    </div>

    <div class="overlay" id="add-modal">
        <div class="modal">
            <div style="display:flex; gap: 10px; margin-bottom: 1.5rem;">
                <button class="btn btn-ghost" onclick="toggleAddTab('create')" id="btn-tab-create">Create</button>
                <button class="btn btn-ghost" onclick="toggleAddTab('join')" id="btn-tab-join">Join</button>
            </div>
            <div id="box-create">
                <div class="field"><label>Server Name</label><input type="text" id="new-srv-name" maxlength="25"></div>
                <div class="field"><label>Server Code</label><input type="text" id="new-srv-code" maxlength="15"></div>
                <div class="field"><label>Icon URL</label><input type="text" id="new-srv-icon"></div>
                <button class="btn btn-blue" onclick="createServer()">Create</button>
            </div>
            <div id="box-join" style="display:none">
                <div class="field"><label>Server Code</label><input type="text" id="join-code" maxlength="15"></div>
                <button class="btn btn-blue" onclick="joinServer()">Join</button>
            </div>
            <button class="btn btn-ghost" onclick="closeModals()">Cancel</button>
        </div>
    </div>

    <div class="overlay" id="user-modal">
        <div class="modal" style="text-align:center;">
            <img id="u-modal-pfp" class="preview-pfp" src="">
            <h2 id="u-modal-name"></h2>
            <p id="u-modal-id" style="font-family: monospace; margin-bottom: 1.5rem;"></p>
            <div id="role-section" style="border-top: 1px solid var(--border); padding-top: 1rem; display:none;">
                <p style="font-size: 0.7rem; color: var(--text-dim); margin-bottom: 10px;">ADMIN CONTROLS</p>
                <button class="btn btn-blue" onclick="toggleRole('Admin')">Give Admin Role</button>
            </div>
            <button class="btn btn-ghost" onclick="closeModals()">Close</button>
        </div>
    </div>

    <script>
        // --- Setup ---
        const randomPFP = `https://github.com/Blfire/Blfire.github.io/blob/main/images/PFP${Math.floor(Math.random()*3)+1}.png?raw=true`;
        const pingSound = new Audio("https://github.com/Blfire/Blfire.github.io/blob/main/assets/notification.mp3?raw=true");
        
        let user = { id: 'U-' + Math.floor(1000 + Math.random()*9000), name: 'Guest', pfp: randomPFP };
        let servers = [{
            id: 'srv1', name: 'Global Lobby', code: 'GENERAL', icon: '', 
            admins: ['SYSTEM'], roles: {}, 
            channels: ['general', 'announcements', 'private'], 
            messages: { general: [], announcements: [], private: [] },
            pings: [] 
        }];

        let activeSid = 'srv1';
        let activeCh = 'general';
        let lastMsg = 0;
        let selectedUid = null;

        // --- Core Logic ---
        function init() { renderAll(); }

        function renderAll() {
            renderRail();
            renderTop();
            renderChat();
            renderMembers();
        }

        function renderRail() {
            const rail = document.getElementById('server-rail');
            rail.innerHTML = '';
            servers.forEach(s => {
                const srv = document.createElement('div');
                srv.className = `server-icon ${s.id === activeSid ? 'active' : ''} ${s.pings.length > 0 ? 'ping-alert' : ''}`;
                srv.onclick = () => { activeSid = s.id; activeCh = 'general'; s.pings = []; renderAll(); };
                if(s.icon) srv.style.backgroundImage = `url(${s.icon})`;
                else srv.innerText = s.name[0];
                rail.appendChild(srv);
            });
            const add = document.createElement('div');
            add.className = 'server-icon'; add.innerText = '+';
            add.onclick = () => openModal('add-modal');
            rail.appendChild(add);
        }

        function renderTop() {
            const s = servers.find(x => x.id === activeSid);
            document.getElementById('display-srv-name').innerText = s.name;
            document.getElementById('srv-settings-icon').style.display = s.admins.includes(user.id) ? 'block' : 'none';
            
            const tabs = document.getElementById('channel-tabs');
            tabs.innerHTML = '';
            s.channels.forEach(ch => {
                if(ch === 'private' && !s.admins.includes(user.id)) return;
                const t = document.createElement('div');
                t.className = `tab ${ch === activeCh ? 'active' : ''}`;
                t.innerText = '#' + ch;
                t.onclick = () => { activeCh = ch; renderAll(); };
                tabs.appendChild(t);
            });
        }

        function renderChat() {
            const box = document.getElementById('chat-view'); box.innerHTML = '';
            const s = servers.find(x => x.id === activeSid);
            const msgs = s.messages[activeCh] || [];
            
            msgs.forEach(m => {
                const isOwn = m.uid === user.id;
                const isPinged = m.text.includes('@'+user.id) || m.text.includes('@everyone');
                const html = `
                    <div class="msg-row ${isOwn ? 'own' : ''}">
                        <div class="msg-pfp" style="background-image:url(${m.pfp})" onclick="showUser('${m.uid}','${m.name}','${m.pfp}')"></div>
                        <div class="msg-content">
                            <div class="msg-user" onclick="showUser('${m.uid}','${m.name}','${m.pfp}')">${m.name}</div>
                            <div class="msg-bubble ${isPinged ? 'ping-msg' : ''}">${m.text}</div>
                        </div>
                    </div>
                `;
                box.insertAdjacentHTML('beforeend', html);
            });
            box.scrollTop = box.scrollHeight;
        }

        function renderMembers() {
            const list = document.getElementById('member-items'); list.innerHTML = '';
            // For demo, we just show current user + a few mock bots
            const members = [{...user}, {id:'U-001', name:'Blfire Bot', pfp:''}];
            members.forEach(m => {
                const d = document.createElement('div');
                d.className = 'member-item';
                d.onclick = () => showUser(m.id, m.name, m.pfp);
                d.innerHTML = `<div class="msg-pfp" style="width:24px; height:24px; background-image:url(${m.pfp || randomPFP})"></div> ${m.name}`;
                list.appendChild(d);
            });
        }

        // --- Actions ---
        document.getElementById('msg-input').addEventListener('keypress', e => { if(e.key === 'Enter') send(); });

        function send() {
            const inp = document.getElementById('msg-input');
            const wrap = document.getElementById('input-wrap');
            const txt = inp.value.trim();
            const now = Date.now();

            if(!txt) return;
            if(now - lastMsg < 1500) {
                wrap.classList.remove('error-shake'); void wrap.offsetWidth; wrap.classList.add('error-shake');
                return;
            }

            const s = servers.find(x => x.id === activeSid);
            
            // Ping Logic
            if((txt.includes('@'+user.id) || txt.includes('@everyone'))) {
                pingSound.play();
                if(s.id !== activeSid) s.pings.push(Date.now());
            }

            s.messages[activeCh].push({ uid: user.id, name: user.name, pfp: user.pfp, text: txt });
            inp.value = ''; lastMsg = now; renderChat();
        }

        function showUser(id, name, pfp) {
            selectedUid = id;
            document.getElementById('u-modal-name').innerText = name;
            document.getElementById('u-modal-id').innerText = id;
            document.getElementById('u-modal-pfp').src = pfp || randomPFP;
            
            const s = servers.find(x => x.id === activeSid);
            document.getElementById('role-section').style.display = (s.admins.includes(user.id) && id !== user.id) ? 'block' : 'none';
            openModal('user-modal');
        }

        function toggleRole(role) {
            const s = servers.find(x => x.id === activeSid);
            if(!s.admins.includes(selectedUid)) s.admins.push(selectedUid);
            alert(role + " permissions granted."); closeModals(); renderAll();
        }

        // --- Settings & Profile ---
        function openProfile() {
            document.getElementById('prev-pfp').src = user.pfp;
            document.getElementById('prev-name').innerText = user.name;
            document.getElementById('prev-id').innerText = user.id;
            document.getElementById('set-name').value = user.name;
            document.getElementById('set-pfp').value = user.pfp;
            openModal('profile-modal');
        }

        function saveProfile() {
            user.name = document.getElementById('set-name').value || user.name;
            user.pfp = document.getElementById('set-pfp').value || user.pfp;
            closeModals(); renderAll();
        }

        function openSrvSettings() {
            const s = servers.find(x => x.id === activeSid);
            document.getElementById('edit-srv-name').value = s.name;
            document.getElementById('edit-srv-icon').value = s.icon;
            openModal('srv-settings-modal');
        }

        function saveSrvSettings() {
            const s = servers.find(x => x.id === activeSid);
            s.name = document.getElementById('edit-srv-name').value;
            s.icon = document.getElementById('edit-srv-icon').value;
            closeModals(); renderAll();
        }

        function createServer() {
            const name = document.getElementById('new-srv-name').value;
            const code = document.getElementById('new-srv-code').value;
            const icon = document.getElementById('new-srv-icon').value;
            if(!name || !code) return;
            const id = 'srv' + Date.now();
            servers.push({
                id, name, code, icon, admins: [user.id], roles: {},
                channels: ['general', 'announcements', 'private'],
                messages: { general: [], announcements: [], private: [] }, pings: []
            });
            activeSid = id; closeModals(); renderAll();
        }

        function joinServer() {
            const code = document.getElementById('join-code').value;
            const s = servers.find(x => x.code === code);
            if(s) { activeSid = s.id; closeModals(); renderAll(); }
            else alert("Invalid Code");
        }

        // --- Helpers ---
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModals() { document.querySelectorAll('.overlay').forEach(x => x.style.display = 'none'); }
        function toggleAddTab(t) {
            document.getElementById('box-create').style.display = t === 'create' ? 'block' : 'none';
            document.getElementById('box-join').style.display = t === 'join' ? 'block' : 'none';
        }

        init();
    </script>
</body>
</html>
